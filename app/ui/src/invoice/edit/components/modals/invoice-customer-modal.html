<import from="../customer-search"></import>
<import from="../../../../components/search/company-search"></import>

<div class="modal" role="dialog" aria-modal="true" show.bind="open">
    <div class="modal-backdrop"></div>
    <div class="modal-card" style="width: 800px">
        <header class="modal-header">
            <h2 t="invoice.customerModal.title">Customer</h2>
            <button class="icon-btn" aria-label="Close dialog" t="[aria-label]common.close" title="Close" t="[title]common.close" click.trigger="closeModal()">Ã—</button>
        </header>
        <div class="modal-body">
            <div style="display: inline-grid; gap: var(--space-1)">
                <h3 style="margin-bottom: 0px" t="invoice.customerModal.search-title">Search Customer</h3>
                <customer-search style="max-width: 250px"
                                 component.ref="customerSearch"
                                 select-customer-function.bind="(c) => selectCustomer(c)"
                                 confirm-customer-function.bind="() => customer && saveCustomer()">
                </customer-search>

                <h3 class="field full" style="margin-bottom: 0px" t="invoice.customerModal.create-new">Create New</h3>
                <div style="display: grid; gap: 1rem; grid-template-columns: auto auto;">
                    <div class="card">
                        <div class="card-header">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building-icon lucide-building"><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 6h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M16 6h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/><path d="M8 6h.01"/><path d="M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"/><rect x="4" y="2" width="16" height="20" rx="2"/></svg>
                            <h2 t="partner.edit.company-info">Company Info</h2>
                        </div>
                        <div style="display: grid; gap: var(--space-1)">
                            <label class="field">
                                <span t="label.vat-number">VAT Number</span>
                                <input type="text" name="customerId" placeholder="VAT Number" t="[placeholder]label.vat-number" value.bind="customer.PartyTaxScheme.CompanyID.value"  required change.trigger="vatNumberChanged()" style="width: 130px" />
                            </label>
                            <company-search select-company-function.bind="(company) => completeCustomerInfo(company)"
                                            search-query.two-way="customer.PartyName.Name"
                                            on-change-function.bind="() => nameChanged()">
                            </company-search>
                            <label class="field required">
                                <span t="label.peppolId">Peppol ID</span>
                                <input type="text" value.bind="peppolId" change.trigger="peppolIdChanged()"/>
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin-house-icon lucide-map-pin-house"><path d="M15 22a1 1 0 0 1-1-1v-4a1 1 0 0 1 .445-.832l3-2a1 1 0 0 1 1.11 0l3 2A1 1 0 0 1 22 17v4a1 1 0 0 1-1 1z"/><path d="M18 10a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 .601.2"/><path d="M18 22v-3"/><circle cx="10" cy="10" r="3"/></svg>
                            <h2 t="partner.edit.address">Address</h2>
                        </div>

                        <div class="grid grid-col-73">
                            <label class="field full">
                                <span t="label.street">Street</span>
                                <input type="text" name="customerStreet" placeholder="Street" t="[placeholder]label.street" value.bind="customer.PostalAddress.StreetName" required />
                            </label>
                            <label class="field">
                                <span t="label.city">City</span>
                                <input type="text" name="customerCity" placeholder="City" t="[placeholder]label.city" value.bind="customer.PostalAddress.CityName" required />
                            </label>
                            <label class="field">
                                <span t="label.postal-code">Postal Code</span>
                                <input type="text" name="customerPostalCode" placeholder="Postal Code" t="[placeholder]label.postal-code" value.bind="customer.PostalAddress.PostalZone" required />
                            </label>
                        </div>

                        <label class="field" style="margin-top: 20px">
                            <span t="label.country">Country</span>
                            <select value.bind="customer.PostalAddress.Country.IdentificationCode">
                                <option repeat.for="country of Object.entries(countryList)" value.bind="country[0]">${country[1]}</option>
                            </select>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <footer class="modal-footer">
            <label class="field checkbox">
                <input type="checkbox" checked.bind="saveAsPartner" disabled.bind="!customer.PartyName.Name || !peppolId" />
                <span t="invoice.customerModal.save-as-partner"></span>
            </label>
            <button type="button" class="btn" click.trigger="closeModal()" t="[title]common.cancel" t="common.cancel">Cancel</button>
            <button type="button" class="btn primary" click.trigger="saveCustomer()" t="[title]common.confirm" t="common.confirm"
                    disabled.bind="!customer.PartyName.Name || !customer.PartyLegalEntity.RegistrationName || !customer.PartyTaxScheme.CompanyID || !peppolId || !peppolId.includes(':')">Confirm</button>
        </footer>
    </div>
</div>
